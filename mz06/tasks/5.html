<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
<title>Problem statement</title>
</head>
<body>
<h3>Problem mz06-5: mz06-5</h3>
<p>Напишите функцию:</p>
<pre>ssize_t getcwd2(int fd, char *buf, size_t size);</pre>

<p>Параметр <tt>fd</tt> &mdash; это открытый файловый дескриптор каталога, <tt>buf</tt> &mdash; адрес начала
буфера в памяти, <tt>size</tt> &mdash; размер буфера.</p>

<p>Функция должна восстановить полный путь к каталогу, который открыт и связан с файловым дескриптором <tt>fd</tt>.
То есть, если fd &mdash; корневой каталог, то полный путь к каталогу &mdash; &quot;/&quot;.
Если fd &mdash; не корневой каталог, то полный путь к этому каталогу начинается с &quot;/&quot;, состоит из записей в
соответствующих каталогах, являющихся каталогами, но не символическими ссылками. На конце полного пути &quot;/&quot;
должен отсутствовать. Например, &quot;/usr/local/bin&quot; (без кавычек).</p>

<p>Если при выполнении функции не возникло ошибок при выполнении системных вызовов и библиотечных функций,
функция <tt>getcwd2</tt> должна вернуть длину строки &mdash; полного пути к каталогу (без учета \0). В противном случае
функция должна вернуть отрицательное значение.</p>

<p>Если параметр <tt>size</tt> равен 0, то функция должна вернуть только длину пути и больше не выполнять никаких
действий (не модифицировать память по указателю <tt>buf</tt>). Если <tt>size</tt> больше нуля, то по адресу <tt>buf</tt>
должен быть записан восстановленный полный путь к каталогу, но не более чем <tt>size-1</tt> значащих символов
и байт \0. Байт \0 должен быть записан в любом случае.</p>

<p>Функция должна сохранять текущий рабочий каталог процесса, то есть текущий рабочий каталог процесса до
вызова функции должен совпадать с текущим рабочим каталогом процесса после вызова функции. Файловый дескриптор с номером fd
должен остаться открытым и связанным с тем же (исходным) каталогом.</p>

<p>Из функций и системных вызовов работы с файлами и файловой системой разрешается
использовать только opendir, closedir, readdir, stat, lstat, fstat, chdir, fchdir, dirfd. Функции работы со строками
и символами разрешается использовать без ограничений.
</p>

    
</body>
</html>
